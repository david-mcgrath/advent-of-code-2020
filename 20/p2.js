(function () {
	var input = `Tile 1237:
######..#.
...##.#..#
....#..#..
.#.#......
#..##.....
#.#..#..#.
......#..#
#.....#...
..........
..#.#.....

Tile 2113:
.##.####.#
.##.#.#.##
#....#...#
........#.
##.##.#.##
..#.#.....
#.##....#.
.##.......
.......#.#
##..##.#..

Tile 3089:
....###..#
##...#..#.
.....#.#..
...#.....#
..........
#........#
##.##..#.#
....###...
#.#....#..
#####..#..

Tile 1217:
#..#...###
#.#.......
.......###
#.........
....#....#
#..#....##
#.......##
#........#
#.#..#..#.
##....##.#

Tile 2129:
.###.##.##
##.......#
#....#....
#......#.#
#..#.#..##
#.......#.
##....####
..#.....##
#........#
...##.####

Tile 1861:
##.##..#..
...#.#...#
#....#....
......##.#
...#.....#
.........#
##....#...
##...#....
.#...#.##.
#.#.###...

Tile 3907:
.#.#.#...#
........##
##.......#
#......#..
#......##.
..#......#
#.#..#....
...#....#.
.......#..
.#.####.##

Tile 1549:
##.#......
....#.#.##
...#.....#
..........
..#......#
...##....#
..........
#.......#.
##...#...#
.###.##..#

Tile 2699:
..####...#
.##.#..###
..#..##.##
#.#.#...##
#.....#...
#.......##
###...#..#
.....#....
#........#
.#.###....

Tile 2593:
.#....#...
....#.#...
....##....
##...#...#
...#....##
#...#..#.#
..##.#..#.
..####....
.#..#..#..
...###.##.

Tile 3209:
.#..#....#
.....#...#
#.........
..........
#.........
.....#..#.
#.........
##........
..#.......
#.#.....##

Tile 1789:
###..#..#.
#.#..##.##
#...##...#
#.........
..#.#.....
..####..##
#.#..###..
......####
#....####.
..##.#..##

Tile 2111:
#.##.#.###
.#..#....#
.#.#..#...
#.......#.
.......#..
#......#.#
#.........
.....#...#
##.....#..
..##.#..##

Tile 3137:
.####..##.
##.##....#
#....#....
#.........
..#...#.#.
#.#..##.#.
..#...#..#
..#..#.#.#
.......###
#.##...###

Tile 1871:
#.####....
#....#....
......#..#
#.......##
##.#....##
..#..#....
#..#...#..
#.#...#.##
#.##.....#
.##.....##

Tile 3119:
######.##.
..#..##..#
.......##.
#...#.#..#
..#...#...
#..#....#.
#....#....
#......#.#
#.........
......#.##

Tile 1579:
.#.#.#....
#..#.....#
###.....#.
..#.#....#
####......
#.#......#
.......#..
...#.....#
.#####...#
#..#....##

Tile 1249:
#...####..
#.........
...#.....#
#......#.#
....##....
#..#..##.#
#..#.....#
....#.#...
#.#....#..
.##...#.#.

Tile 1319:
....#.####
#.#..#.#.#
#......#..
..#.#.#..#
..#....#.#
##....#.#.
###...#...
###......#
..#..#..##
..#.#..##.

Tile 1987:
.#...####.
...#...###
...##...##
..#..#..#.
##.....#..
#..#....##
.#.....#.#
#......#..
##......#.
..###...#.

Tile 2963:
.##.#####.
#.##...##.
#..##.....
..#......#
..##.....#
.#..#..#.#
..........
#...#..##.
...#......
##..#####.

Tile 1609:
..##..###.
.....#..#.
.....#....
##....#...
###..#...#
##....#..#
......##..
..#..###..
#....#.#..
...##....#

Tile 2267:
...#.#..#.
..##....##
####..#.##
....#.##.#
##..#.....
..##.#....
#.##...###
#..##.###.
..........
..#..##...

Tile 1531:
#.#..##..#
#........#
#.....####
....#...##
#.....##.#
#.........
......##.#
.#.#..#..#
.........#
#..#.#.#.#

Tile 2357:
.......#..
...#..#...
.......#..
.#...#.###
#.####...#
.#.#.....#
#.#.....#.
.###..##.#
#.#.#...#.
##.#.#####

Tile 1373:
.#.....###
..#...##..
..#......#
...#...#.#
.#..#.#..#
......#...
#...##..#.
#...#..##.
...#......
##.#.#...#

Tile 3373:
...##.#.##
#.........
....#....#
#..###...#
#...#...##
......#.##
........#.
.......##.
#..#...#..
.##..#.#..

Tile 1831:
...#####.#
#........#
#.....#..#
#.#...###.
...#.##..#
..##.....#
..#....#..
......##.#
##...#....
##.###.#.#

Tile 3607:
#...#.#...
.#...##.##
.#.......#
..####....
####....#.
.#.#...#.#
###...##..
#......#..
###.#..#.#
##.##..###

Tile 3251:
##.#..##..
.#....##.#
#.......#.
..#..#..#.
#..##....#
#...##..##
.....#..##
...#...##.
....##....
#####...##

Tile 3917:
.##.......
.#..#...#.
....##...#
#.#..##.##
.#.#...#..
..#.......
.....#..#.
.#..#.#..#
...##..#.#
##..#...##

Tile 1489:
.##..##.#.
##...#.#.#
#.......#.
##.#.....#
.#...##..#
..#.......
.#..#....#
###..#..##
#..##.....
#######...

Tile 3253:
#..#..####
....#..#..
#.##..#...
.##....###
........##
..........
#...#.....
##...#...#
...##.....
.##..##.#.

Tile 2081:
.......##.
#...#....#
#..#....##
##....##..
#.#.###...
.....#....
#...###.##
##..##....
#........#
.#...#..#.

Tile 1481:
######..#.
###.#....#
.....#...#
#.........
#..#....##
#........#
..........
#...#....#
#..#.##...
#####..##.

Tile 2953:
..##.#####
#.#..#..##
..#....#.#
#...#.#...
#..##....#
#.#....#.#
.......#.#
#..##.....
#.#.....##
...##..#.#

Tile 1783:
.#..#.#.##
#...#....#
...#......
#.#.#..#.#
.........#
......#...
.#...#..##
..#...#.#.
#..#..#..#
...#..#.##

Tile 2269:
#.#.##..#.
#.....##..
.#.......#
..#..#...#
....#.....
..........
##.##....#
.....#....
##.....###
.#.#####.#

Tile 1277:
..##..#...
#...#.....
.......#..
...#......
....#....#
..#.......
#......#..
.#........
#.........
###.###...

Tile 2633:
####.#.#..
......#.#.
........#.
#.........
...#...###
...#.....#
.##.#..#.#
.#........
#.#......#
.##.##.#.#

Tile 3919:
###..###..
...#......
...##.#..#
#...#..#.#
.........#
...#.#.#..
...#.#....
#....#...#
.#.###..##
.#.#.##...

Tile 1753:
#...##....
#.....#...
..........
.#..#.....
#.......##
..#.......
......#..#
#..####...
....#..#.#
..#.####..

Tile 3739:
.##.#.#..#
###.##.##.
##.###.#..
.#....#..#
#...##....
#..#......
#....###.#
..#.......
###....#.#
...###..#.

Tile 3701:
.####..#.#
#.....#...
.#........
.........#
...#.#....
#.#.......
#...#....#
.###.#.##.
#.#.......
##.##..##.

Tile 3631:
#..#..###.
.........#
#...##....
.......#.#
.....#....
...#..#..#
........#.
..#....#.#
......#...
##.#..#.#.

Tile 2389:
..#.##...#
###.......
#..##...##
#.######..
..#..##...
.#...#...#
.....#...#
#..#....#.
..#...##..
#...#..##.

Tile 1123:
.##.#.###.
#........#
#.........
#.....##.#
....#.....
....##.#.#
....#....#
#.#.#..#.#
#..#.....#
#.#..#..#.

Tile 2659:
#.##.#.##.
.#........
#....#..##
###..##.##
#.#.###..#
#...##...#
...#...#..
...#..#...
..#.#.#..#
####...#..

Tile 3709:
.##...#.##
..#..##..#
......#.##
......#..#
....#.....
..........
#......#.#
#....##..#
.....##..#
####.##...

Tile 2887:
######..##
#.........
.......#.#
...#.#....
#....##...
#...#....#
...#.#...#
#....#...#
##....#..#
#########.

Tile 1367:
#.####.###
#......#.#
..........
#....#....
.#......#.
#.........
...#.#.#..
......#...
##....#...
.....##.##

Tile 2221:
##..#.....
#.....#...
.........#
#..#......
#.#...#...
###......#
...#.....#
#........#
#.....#...
..##.###..

Tile 2621:
##..#.###.
.......###
.........#
..#.#...#.
..........
....#.....
#.##..##..
......#..#
....#...#.
##.#.....#

Tile 2503:
..#.##.##.
......#...
#.#..#....
....#....#
#.....#...
..#......#
##...#..#.
#....#..#.
...#......
#....####.

Tile 3491:
#..#.###..
#.........
#..#..#..#
###....###
#.#.##....
#........#
......#...
##...#...#
##........
.#.#.##.##

Tile 2333:
..##.....#
.....#..#.
#.#.#..#.#
##.##...#.
..#.#.....
...#.....#
..###..#..
###.....##
#........#
##.####.#.

Tile 2399:
.....#.##.
##.....#.#
##.......#
.#.#..##.#
#...##...#
###.#....#
#......#..
##......#.
#.#....#..
.....#.#..

Tile 2683:
#.##..##..
.#....#..#
.........#
.......#.#
.##.#..##.
.....##..#
#....##..#
....##.#.#
...###.###
.#.##.#.##

Tile 1741:
.##..#.#.#
.##....#..
##..#.....
##...###..
......#..#
#.....#...
.......#..
#.....#...
...##..#.#
#..###.##.

Tile 3539:
.###....##
..........
.##.#...#.
.....#...#
.........#
.........#
.......#..
..#.....#.
.#.#.###.#
#.#.####.#

Tile 3929:
##..######
.#..##.###
#.##....#.
...##..#.#
#...#.....
........#.
.....#...#
#...#.#..#
.#.#.....#
..##.#..#.

Tile 3221:
..####..#.
##......#.
..#..#.###
##........
....#....#
.#...#...#
#.#...#..#
##....#..#
##......#.
.#..#..##.

Tile 1117:
.##.##.#.#
##.....###
#.#.#.##..
..#....#..
##....#...
...#..##.#
..#.#.#..#
...#...#.#
....##...#
.###.#..##

Tile 3163:
.####.#.#.
#.........
..........
......#..#
....##.#..
.#....#..#
.....####.
#....#.#..
...#.#..##
##.#.#....

Tile 1129:
.....##...
##......##
#..#..#..#
..#....#..
#.#...#...
....#.##..
...#...#..
#.........
#..#..#.#.
#.#..###.#

Tile 3079:
###..#.##.
....###...
##..#....#
....##...#
......##..
....#....#
#.#.#.....
#...#....#
.#........
.##.#.###.

Tile 2039:
.#.#.##..#
..##......
.##.......
#.........
....#...##
#..#.#...#
..........
#.....#..#
####..#..#
.#..#..##.

Tile 1901:
####.#.##.
#.#...##..
...#....##
..........
#.........
#...##...#
..........
##......##
.#.....#..
.###.##...

Tile 2029:
####..##..
##...#....
.#....##.#
..#....##.
#........#
..........
..........
#..#..#...
#..#....##
....####..

Tile 1879:
##..#.##.#
#...#...##
.##...#.##
.#.#.....#
.##.#..#.#
#..##.....
#..##...#.
......#.##
...#..#..#
#....#..#.

Tile 3347:
###..#..##
.#..#....#
.#...#...#
....#....#
.#......##
......##.#
.....#..##
.........#
#......#..
.####.#..#

Tile 2417:
####.#..##
...#.#....
.#....#..#
.#........
#.........
.....#....
#..##.....
#..#...#.#
#..#.##..#
..##..####

Tile 2897:
...#..#.##
#.#.......
.........#
#.#.#..#..
..#.......
.........#
.##...#..#
....#..###
.###...##.
.#.#.#.#..

Tile 2837:
.#....###.
.......#..
......#..#
#..#..#.##
#.#.##...#
#...#....#
...##.#.#.
#.....#..#
#.#.....#.
#####.####

Tile 3001:
##....#..#
#....#.#..
.....##..#
.....##..#
...#......
#.....#..#
#.#...##.#
.#...#...#
........#.
###.####.#

Tile 2153:
.####.##..
#..#.....#
..#....#..
#......#.#
.........#
.###.....#
#.##.....#
#..#......
#.#.......
.######..#

Tile 2749:
..##.###..
#..#...#..
..##.....#
###.......
#..##.....
......#..#
..#..##...
.###.....#
#.#.......
...#..#..#

Tile 2791:
..##.##.#.
.##.###.#.
.#..#....#
.##..#.#.#
#..#....#.
......##..
#.##.#.#.#
##...#.##.
.#...#.#..
...#.#...#

Tile 2707:
..###...##
.#....#...
..#...##..
#.#.......
....#....#
#.....#...
.........#
##.....###
#........#
#.##.#####

Tile 2969:
..#####..#
..........
#.....#..#
....#.#..#
...#......
..##.#...#
...#.#....
...#.....#
..#.......
####..##.#

Tile 3329:
#.###..#..
...#....#.
........#.
.........#
###.#..#.#
.#.......#
.........#
.......#..
#....##..#
##.###.#..

Tile 3989:
.#####.###
#....#.#..
.........#
.........#
##.#...#.#
......#..#
...#.....#
###......#
.#.......#
.###.##.#.

Tile 3583:
..#..#.#..
.#........
###...##..
##.....#..
##.......#
#.........
#.........
#...#..#.#
##.#......
#.........

Tile 3931:
....#..#..
#.#.#.....
..#..#..#.
.##...##.#
.......#.#
.........#
....#...##
......#..#
#.#....#..
#.#.#.##.#

Tile 1493:
####..##.#
..........
....#..#..
##...####.
#.........
#.........
.#.#.....#
....##...#
......##..
.#########

Tile 1013:
#.###....#
....####.#
...#.####.
.......##.
.#..#....#
#.........
#......#..
...#...#..
#.....#...
#.#.#####.

Tile 2089:
.#...#.##.
..#...#..#
........#.
...#.#..#.
.....##..#
#...###...
#....#.#..
#....#..#.
#...###..#
........##

Tile 1613:
#.#...####
#.....#...
#....##..#
#....#....
.#....#...
#........#
......#.#.
#.....#...
##...#...#
....#..##.

Tile 3331:
.#.#.#####
.....#...#
.......#..
##..#...#.
#........#
......#..#
..#.#....#
.......#..
..#.......
###.###..#

Tile 3217:
..#.###...
#.##......
..#...##..
...#.##..#
###...###.
#...#.#.#.
##.#...#..
.........#
.....##...
##.###....

Tile 3011:
#.##.#....
....#...##
..........
#........#
#....#...#
#..#......
..........
.........#
....##....
##.####...

Tile 1171:
###..###.#
..#.....##
##.#...#..
.#.......#
..........
##.....##.
.##.....##
..#...####
##.##..#.#
#.#.#.#...

Tile 1933:
#####..#..
#.#.#.#...
#.#.......
#.#.#.....
.....#...#
#.#.......
..........
...#..#...
.##....#..
......#...

Tile 2141:
#.###...#.
#.....#...
.........#
.....#..#.
#.###.....
#..###.#..
.....#..#.
....#....#
.#.......#
...##..##.

Tile 1031:
###...#..#
#.......#.
##.#..#..#
##..#.....
#...#.....
##....#...
#......##.
#.........
......#..#
....#..##.

Tile 2857:
#.#..#...#
#........#
##.#..#.##
....#.##..
....#...##
#...#.....
#..#......
.......###
#...####.#
.#...####.

Tile 3313:
.#......##
...##.....
.#.##.....
#.#.#.....
#.#..#....
..#.......
#..#.#...#
#.#......#
##...#....
..###.##.#

Tile 1303:
#.##.#....
#.......##
...#...##.
....##...#
.....#...#
.........#
#..#...#.#
##...##...
...#.#.#..
....##..##

Tile 3457:
#...#.#..#
.........#
#.#..#...#
.....#.#..
........##
...#......
..##.##...
..........
....#....#
#...#..#.#

Tile 3643:
##.##..###
..#.#....#
..##.....#
..#.......
#.........
#.........
#.......#.
......#..#
.#......#.
.###..##.#

Tile 2803:
#...#..##.
##....#.##
.#.......#
#...###...
#...###..#
#..#......
.......#.#
#.......#.
...##.....
..#..##.##

Tile 2549:
.#....####
.#........
.....###..
.....#..##
..#.###...
......#...
.........#
.......##.
#......#.#
..###.####

Tile 3571:
#..#.##...
...#....#.
..##..##..
....#.##.#
.#.....#..
.##...#...
.##......#
#.#......#
......#...
.#..#..#..

Tile 1327:
#..###...#
#....#...#
#.##...#.#
#.......#.
#.#...#..#
.........#
##........
....#..#..
.....#..#.
.#.###..##

Tile 2833:
##...#..#.
##....#..#
##.#.....#
.......#..
###...#..#
.........#
#.#....###
....##.#..
..#...#...
..#.#.#.##

Tile 1997:
##..#...##
#...#.....
#.....#...
.......#..
.......#.#
#.........
#......#..
.........#
..#.#.#..#
.###.##..#

Tile 3673:
..#..###..
.#..##....
#.##.....#
.####..###
##..#..#..
#.#.#...##
.#....#.#.
....#.##..
#...#....#
..#.##....

Tile 3323:
.#...#####
#..#...#.#
..........
#....#...#
.#........
#........#
##......##
...##...#.
...#.#..##
#.##.###.#

Tile 1619:
#..###.###
#...##...#
.#........
#.#.....#.
#.##.....#
#......#..
.......#..
#####.#..#
..........
####...#..

Tile 2477:
.##.##..#.
#.#.#.....
......#..#
......#.#.
##.##.....
.###.#..#.
.........#
...#.#....
#.....#...
...##.#...

Tile 3389:
#...#.#.##
##.#.....#
......#..#
#..#.#...#
#....#..#.
##......##
....#...##
#.##..##..
#........#
...##.#.##

Tile 1193:
.##...###.
#...##..#.
###.......
#.#..#....
.#..#.#...
#..##....#
#.#..##...
####.....#
#...#..#..
..##.....#

Tile 3767:
#...#.....
...#.#..#.
#######...
...#.#....
#.........
.#....##..
#.#.......
.#.#.#..#.
..#.###..#
....##.#..

Tile 3191:
#.##...#..
..........
......####
#..#..#...
....#.#.##
......#.#.
.....#....
.#....##.#
..#..#.#.#
#...##.#.#

Tile 3049:
#...#...#.
.#..#....#
##.#.....#
...#...##.
#.##.....#
.....#.#..
..##..##..
..........
#....#.#.#
#.##.#..#.

Tile 1747:
###....#..
....#..#.#
.......#..
........#.
#..#......
.......###
...#.##...
.....#..##
.#....#...
.##..####.

Tile 1429:
...#.#.#..
.#...#....
..........
##........
#.........
#..#.#....
.##.......
.#........
.##.#.#..#
#####.##.#

Tile 2909:
#.##.###..
#..#.....#
#...#.....
.#..#.##..
#.#.....#.
#...#...##
...#...#..
.##.....##
##..#..#.#
#.###..###

Tile 1973:
#####.#.#.
...#.....#
#.........
#........#
.....###..
..........
.#.....#.#
.##..#.##.
##.#..#...
#.##...#.#

Tile 3449:
.#.#.#..#.
#...#.#...
..#.##....
#...###...
.....#...#
#.......#.
##....#.##
......#..#
#.......#.
..####....

Tile 3371:
##.#..#.#.
#...##...#
##...##...
.#....#...
#...##...#
..#......#
......#..#
##.###...#
#....#...#
.##....#..

Tile 1103:
####..#..#
.......#..
#......#.#
..........
.#....##..
.#.##...##
##....##.#
..#..#.###
..........
.#.#...#.#

Tile 1723:
.#....###.
...#.#...#
..#.#.....
#####....#
.#.#......
....#..#..
..#.......
..##...#.#
....###...
...##.#.#.

Tile 1093:
..##.#.###
.##.......
#....#....
.#.....#..
#.......##
.........#
.#......##
#......#.#
#..#.#...#
#.#####.#.

Tile 1321:
#.#.###.#.
.#..##..#.
#.###..#..
#..##....#
#.......#.
....#....#
#....#...#
.....#....
#.###.....
.###...##.

Tile 1979:
#####.###.
#.#..#..#.
#.####....
###.....##
....#.....
#.........
###.#..#.#
..##...###
#.......##
..#.......

Tile 2677:
##..#.##.#
#.##.....#
#..#...#.#
..#.#.#..#
##.#..#..#
.....#..#.
#...#...##
...#...###
##.#...#..
.###..##..

Tile 1553:
.#...###..
.........#
###.......
##..#...#.
..#...##.#
..##......
.##.......
...#..#...
#....##...
#####.#...

Tile 3187:
###..#..#.
#.....#...
.....#..##
#.....#..#
..#......#
##...#....
......##.#
......#...
#.#..#....
########.#

Tile 2243:
##.####...
..#.#.#..#
#..#......
.........#
....#...##
#.........
#......#.#
....#....#
......#.##
##.#....#.

Tile 1423:
..#..##..#
..#....#.#
#.#.....##
##.......#
.#..#..#..
......##..
##...##...
.....##..#
...#.#.#.#
##...###..

Tile 3319:
##.##.#.#.
#.......#.
....#.....
###....###
........#.
###.......
.#.....##.
#...#....#
..#.......
.##...####

Tile 3343:
.#...#####
..........
.###...#.#
.##.......
..........
##....####
#......#.#
#.#.###..#
..#.......
.#####..#.

Tile 2789:
##....####
.##.......
#......#.#
.#.##.....
#......#.#
#........#
##......#.
.#...##...
#.....##.#
...###.#..

Tile 3623:
##..#..#.#
#.....#.#.
##.....#.#
.#...##..#
.#.......#
..#...#..#
.#..#..##.
###..#.###
.#.##.#..#
.#.##.#.#.

Tile 1439:
.#..#.#.#.
....#.....
.........#
#..#......
##..#....#
#.#.#.##..
##.#.#...#
#.........
#.......#.
####...#.#

Tile 1361:
#.#...###.
#.........
....#.....
..#.......
......#..#
##....##.#
.##..#..##
..#......#
.....##..#
#..#....#.

Tile 1823:
.##.#.#...
#.........
#..#.##.#.
#...##....
##........
#...#.#.##
#........#
.........#
........#.
#.###...#.

Tile 2971:
.#.......#
#.#....#..
#..#.#....
...#..#...
##....#...
#..#......
.........#
....##....
#...###..#
#...#.#.#.

Tile 3229:
..###.####
#........#
.#.......#
..........
##.......#
#..#......
.#.#......
#.....##.#
.#......#.
.#####.#.#

Tile 1907:
####.#.#..
....#....#
#....#....
#.........
#...#..###
...#.#.#.#
....##....
#.###..###
..#..##.##
..##.##...

Tile 1699:
..#..##...
.#..#.#...
.....#...#
.#.#.#...#
........#.
##.....#..
#.#......#
.##......#
....###.#.
...##..###

Tile 2131:
#..#####..
#....#...#
#..####..#
......#..#
#.#..#...#
#.#...#..#
..##......
#.#####..#
......#..#
#...####.#

Tile 1657:
..#..##.#.
#....##...
##..#....#
#........#
#.........
#.......##
#......###
#.#.#...##
........##
#.##.#.##.
`;

	// input = `Tile 2311:
// ..##.#..#.
// ##..#.....
// #...##..#.
// ####.#...#
// ##.##.###.
// ##...#.###
// .#.#.#..##
// ..#....#..
// ###...#.#.
// ..###..###

// Tile 1951:
// #.##...##.
// #.####...#
// .....#..##
// #...######
// .##.#....#
// .###.#####
// ###.##.##.
// .###....#.
// ..#.#..#.#
// #...##.#..

// Tile 1171:
// ####...##.
// #..##.#..#
// ##.#..#.#.
// .###.####.
// ..###.####
// .##....##.
// .#...####.
// #.##.####.
// ####..#...
// .....##...

// Tile 1427:
// ###.##.#..
// .#..#.##..
// .#.##.#..#
// #.#.#.##.#
// ....#...##
// ...##..##.
// ...#.#####
// .#.####.#.
// ..#..###.#
// ..##.#..#.

// Tile 1489:
// ##.#.#....
// ..##...#..
// .##..##...
// ..#...#...
// #####...#.
// #..#.#.#.#
// ...#.#.#..
// ##.#...##.
// ..##.##.##
// ###.##.#..

// Tile 2473:
// #....####.
// #..#.##...
// #.##..#...
// ######.#.#
// .#...#.#.#
// .#########
// .###.#..#.
// ########.#
// ##...##.#.
// ..###.#.#.

// Tile 2971:
// ..#.#....#
// #...###...
// #.#.###...
// ##.##..#..
// .#####..##
// .#..####.#
// #..#.#..#.
// ..####.###
// ..#.#.###.
// ...#.#.#.#

// Tile 2729:
// ...#.#.#.#
// ####.#....
// ..#.#.....
// ....#..#.#
// .##..##.#.
// .#.####...
// ####.#.#..
// ##.####...
// ##..#.##..
// #.##...##.

// Tile 3079:
// #.#.#####.
// .#..######
// ..#.......
// ######....
// ####.#..#.
// .#...#.##.
// #.#####.##
// ..#.###...
// ..#.......
// ..#.###...` // expected result: 20899048083289

	input = input
		.split("\n\n")
		.map(x => x.split(":\n"))
		.map(x => {
			function connections(str) {
				var internal = 0;
				var external = 0;
				
				for (var i = 0; i < str.length; i++) {
					if (str[i] === "#") {
						internal += 2 ** i;
						external += 2 ** (str.length - i - 1);
					}
				}
				
				return {
					Internal: internal,
					External: external
				};
			}
			
			var tile = x[1].split("\n");
			
			return {
				Key: x[0].replace("Tile ", "") + "_0_0",
				Id: +x[0].replace("Tile ", ""),
				Rotation: 0,
				Flipped: false,
				U: connections(tile[0]),
				R: connections(tile.map(x => x[9]).join("")),
				D: connections(tile[9].split("").reverse().join("")),
				L: connections(tile.map(x => x[0]).reverse().join("")),
				Image: tile.filter((x, i) => i > 0 && i < 9).map(x => x.split("").filter((x, i) => i > 0 && i < 9).join(""))
			};
		});
	
	function rotate(tile) {
		var i = tile.Image;
		var rotatedImage = [
			i[7][0] + i[6][0] + i[5][0] + i[4][0] + i[3][0] + i[2][0] + i[1][0] + i[0][0],
			i[7][1] + i[6][1] + i[5][1] + i[4][1] + i[3][1] + i[2][1] + i[1][1] + i[0][1],
			i[7][2] + i[6][2] + i[5][2] + i[4][2] + i[3][2] + i[2][2] + i[1][2] + i[0][2],
			i[7][3] + i[6][3] + i[5][3] + i[4][3] + i[3][3] + i[2][3] + i[1][3] + i[0][3],
			i[7][4] + i[6][4] + i[5][4] + i[4][4] + i[3][4] + i[2][4] + i[1][4] + i[0][4],
			i[7][5] + i[6][5] + i[5][5] + i[4][5] + i[3][5] + i[2][5] + i[1][5] + i[0][5],
			i[7][6] + i[6][6] + i[5][6] + i[4][6] + i[3][6] + i[2][6] + i[1][6] + i[0][6],
			i[7][7] + i[6][7] + i[5][7] + i[4][7] + i[3][7] + i[2][7] + i[1][7] + i[0][7]
		];
		
		return {
			Key: tile.Id + "_" + ((tile.Rotation + 1) % 4) + "_" + (tile.Flipped ? 1 : 0),
			Id: tile.Id,
			Flipped: tile.Flipped,
			Rotation: (tile.Rotation + 1) % 4,
			U: tile.L,
			R: tile.U,
			D: tile.R,
			L: tile.D,
			Image: rotatedImage
		};
	}
	function flip(tile) {
		return {
			Key: tile.Id + "_" + tile.Rotation + "_" + (tile.Flipped ? 0 : 1),
			Id: tile.Id,
			Flipped: !tile.Flipped,
			Rotation: tile.Rotation,
			U: { Internal: tile.D.External, External: tile.D.Internal },
			R: { Internal: tile.R.External, External: tile.R.Internal },
			D: { Internal: tile.U.External, External: tile.U.Internal },
			L: { Internal: tile.L.External, External: tile.L.Internal },
			Image: tile.Image.map(x => x).reverse()
		};
	}
	
	// Find pairs
	
	var transformations = input
		.concat(input.map(flip))
		.concat(input.map(flip).map(rotate))
		.concat(input.map(flip).map(rotate).map(rotate))
		.concat(input.map(flip).map(rotate).map(rotate).map(rotate))
		.concat(input.map(rotate))
		.concat(input.map(rotate).map(rotate))
		.concat(input.map(rotate).map(rotate).map(rotate));
		
	var transformations_dict = transformations.reduce((a, b) => { a[b.Key] = b; return a; }, {});
	
	var right_pairs = transformations
		.map(x => {
			return {
				Key: x.Key,
				Pairs: transformations
					.filter(y => x.Id !== y.Id && x.R.Internal === y.L.External)
					.map(y => y.Key)
			};
		})
		.reduce((a, b) => { a[b.Key] = b.Pairs; return a; }, {});
	var down_pairs = transformations
		.map(x => {
			return {
				Key: x.Key,
				Pairs: transformations
					.filter(y => x.Id !== y.Id && x.D.Internal === y.U.External)
					.map(y => y.Key)
			};
		})
		.reduce((a, b) => { a[b.Key] = b.Pairs; return a; }, {});
	
	function generate(map, seen, i, j) {
		if (!map) {
			map = [];
			var size = Math.sqrt(input.length);
			for (var ii = 0; ii < size; ii++) {
				map.push([]);
				for (var jj = 0; jj < size; jj++) {
					map[ii].push(null);
				}
			}
		}
		seen = seen || [];
		i = i || 0;
		j = j || 0;
		
		// Get all tiles that fulfil the constraints and then check the next point for each one in that list
		var right_constraint = j > 0 ? right_pairs[map[i][j - 1]] : null;
		var down_constraint = i > 0 ? down_pairs[map[i - 1][j]] : null;
		
		var options = transformations
			.filter(x => seen.indexOf(x.Id) === -1)
			.filter(x => !right_constraint || right_constraint.indexOf(x.Key) > -1)
			.filter(x => !down_constraint || down_constraint.indexOf(x.Key) > -1);
		
		var _i, _j;
		if (j === map[i].length - 1) {
			if (i === map.length - 1) {
				return options
					.map(x => {
						var copy = map.map(y => y.map(z => z));
						copy[i][j] = x.Key;
						return copy;
					});
			}
			else {
				_i = i + 1;
				_j = 0;
			}
		}
		else {
			_i = i;
			_j = j + 1;
		}
		
		return options
			.map(x => {
				var copy = map.map(y => y.map(z => z));
				copy[i][j] = x.Key;
				var seen_copy = seen.map(y => y);
				seen_copy.push(x.Id)
				return generate(copy, seen_copy, _i, _j);
			})
			.reduce((a, b) => a.concat(b), []);
	}
	
	var monster_template = `                  # 
#    ##    ##    ###
 #  #  #  #  #  #   `;
 
	var monster_deltas = monster_template
		.split("\n")
		.map((x, i) => x
			.split("")
			.map((y, j) => y === "#" ? { i: i, j: j } : null)
			.filter(y => y))
		.reduce((a, b) => a.concat(b));
	
	var max_delta_i = 0;
	var max_delta_j = 0;
	
	for (var i = 0; i < monster_deltas.length; i++) {
		var delta = monster_deltas[i]
		if (delta.i > max_delta_i) max_delta_i = delta.i;
		if (delta.j > max_delta_j) max_delta_j = delta.j;
	}
	
	return generate()
		.map(x => x
			.map(y => y
				.map(z => transformations_dict[z].Image)
				.reduce((a, b) => a.map((row, i) => row.concat(b[i]))))
			.reduce((a, b) => a.concat(b)))
		.map(x => {
			return {
				Image: x,
				Monsters: []
			};
		})
		.map(x => {
			for (var i = 0; i < x.Image.length - max_delta_i; i++) {
				for (var j = 0; j < x.Image[i].length - max_delta_j; j++) {
					var failed = false;
					
					for (var k = 0; k < monster_deltas.length; k++) {
						var delta = monster_deltas[k];
						if (x.Image[i + delta.i][j + delta.j] !== "#") {
							failed = true;
							break;
						}
					}
					
					if (!failed) {
						x.Monsters.push({ i: i, j: j });
					}
				}
			}
			
			return x;
		})
		.filter(x => x.Monsters.length > 0)
		.map(x => {
			var copy = x.Image.map(y => y.split("").map(z => z === "#" ? 1 : 0));
			
			for (var i = 0; i < x.Monsters.length; i++) {
				var monster = x.Monsters[i];
				for (var j = 0; j < monster_deltas.length; j++) {
					var delta = monster_deltas[j];
					copy[monster.i + delta.i][monster.j + delta.j] = 0;
				}
			}
			
			return copy;
		})
		.reduce((a, b) => a.concat(b))
		.reduce((a, b) => a.concat(b))
		.reduce((a, b) => a + b);
})();